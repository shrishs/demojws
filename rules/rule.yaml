- ruleID: route-to-ingress-00001
  category: mandatory
  effort: 3
  labels:
    - konveyor.io/source=openshift
    - konveyor.io/target=kubernetes
    - konveyor.io/target=networking.k8s.io/v1
    - konveyor.io/target=cloud-readiness
  when:
    and:
      # # Limit to YAML files typically checked into the app repo
      # - builtin.file:
      #     pattern: "**/*.y?(a)ml"
      # # Detect OpenShift Route manifests
      # - builtin.filecontent:
      #     # Either of these lines in the same file is a strong signal
      #     pattern: "(?m)^\\s*apiVersion:\\s*route\\.openshift\\.io/v1\\s*$"
      # - builtin.filecontent:
      #     pattern: "(?m)^\\s*kind:\\s*Route\\s*$"
      - builtin.filecontent:
          filePattern: "*.yaml"
          pattern: "kind: Route"         
  description: >
    OpenShift Route resources are cluster-specific and should be converted to a
    standard Kubernetes Ingress for portability.This is important part of our Migration strategy.
  message: |
    This repository defines an **OpenShift Route**. Convert it to a **Kubernetes Ingress**.This is important part of our Migration strategy.

    **Key mappings:**
    - `spec.host`         → `spec.rules[0].host`
    - `spec.path`         → `spec.rules[0].http.paths[0].path` (use `pathType: Prefix`)
    - `spec.to.name`      → `spec.rules[0].http.paths[0].backend.service.name`
    - `spec.port.targetPort` → `spec.rules[0].http.paths[0].backend.service.port.{name|number}`

    ** Notes **
    - While generating the code maintain the yaml syntax,
    - Do not write any additional comments.

    **Example conversion**

    _OpenShift Route (before):_
    ```yaml
    apiVersion: route.openshift.io/v1
    kind: Route
    metadata:
      name: myapp
    spec:
      host: example.com
      path: /
      to:
        kind: Service
        name: myapp
      port:
        targetPort: 8080
    ```

    _Kubernetes Ingress (after):_
    ```yaml
    apiVersion: networking.k8s.io/v1
    kind: Ingress
    metadata:
      name: myapp
    spec:
      rules:
        - host: example.com
          http:
            paths:
              - path: /
                pathType: Prefix
                backend:
                  service:
                    name: myapp
                    port:
                      number: 8080
    ```

  links:
    - title: Kubernetes Ingress (networking.k8s.io/v1)
      url: https://kubernetes.io/docs/concepts/services-networking/ingress/
    - title: OpenShift Route API
      url: https://docs.openshift.com/container-platform/latest/networking/routes/route-configuration.html